<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>屬靈健康檢查（含 PDF 下載）</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(135deg,#eaf2ff,#fff);
      font-family: "Microsoft JhengHei", "Noto Sans TC", sans-serif;
      color: #2c3e50;
      padding: 24px 12px;
    }
    .card {
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    .section-title {
      background:#fff6f6;
      padding:10px 12px;
      border-radius:8px;
      color:#c0392b;
      font-weight:700;
    }
    label.small { font-size:0.95rem; }
    input[type=number] { max-width:110px; }
    .score-box { min-width:110px; }
    .result-area { background:#f8f9fa; border-radius:8px; padding:14px; }
    .note { font-size:0.9rem; color:#666; }
    .btn-download { min-width:200px; }
    /* PDF friendly: make form area white for capture */
    #pdfArea { background: white; padding: 18px; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card p-4" id="mainCard">
      <div id="pdfArea">
        <div class="text-center mb-3">
          <h2 class="mb-1" style="color:#e74c3c">屬靈健康檢查</h2>
          <p class="mb-0 note">親愛的弟兄姊妹，您是否盼望擁有健康均衡的基督徒生活？ 快來作個屬靈的健康檢查，以便預防建康失調喔! 如果發現問題，也可以盡快對症下藥、重拾健康。此檢查表每項均要填入一個分數，計分方式為1~3不良，4~6普通，7~10良好三個程度。 請自我評定各項的分數，並於下方表中歸納填寫結論。</p>
        </div>

        <!-- 親近主 -->
        <div class="mb-3">
          <div class="section-title mb-2">一、親近主 (靈修)</div>
          <div class="row g-2 align-items-center">
            <div class="col-9"><label class="small">1. 與神獨處的時間及品質是否滿意？</label></div>
            <div class="col-3">
              <input type="number" min="0" max="10" class="form-control score-box" id="A" oninput="calcAll()">
            </div>

            <div class="col-9"><label class="small">2. 是否每天靈修？</label></div>
            <div class="col-3">
              <input type="number" min="0" max="10" class="form-control score-box" id="B" oninput="calcAll()">
            </div>

            <div class="col-9"><label class="small">3. 研經備經：讀經胃口、狀況好不好？</label></div>
            <div class="col-3">
              <input type="number" min="0" max="10" class="form-control score-box" id="C" oninput="calcAll()">
            </div>

            <div class="col-9"><label class="small">4. 靈修筆記：有沒有每天將靈修心得或誠懇的事記下來，讚美神的作為？</label></div>
            <div class="col-3">
              <input type="number" min="0" max="10" class="form-control score-box" id="D" oninput="calcAll()">
            </div>

            <div class="col-9"><label class="small">5. 勞苦重擔：最近勞苦重擔多不多？有沒有交託給神？</label></div>
            <div class="col-3">
              <input type="number" min="0" max="10" class="form-control score-box" id="E" oninput="calcAll()">
            </div>
          </div>
          <div class="mt-2 text-end"><small>平均：<span id="avgA">-</span></small></div>
        </div>

        <!-- 生死盟 -->
        <div class="mb-3">
          <div class="section-title mb-2">二、生死盟</div>
          <div class="row g-2 align-items-center">
            <div class="col-9"><label class="small">1. 小組肢體生活：是否穩定參加小組？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="F" oninput="calcAll()"></div>
            <font color=blue>代禱同伴</font>
            <div class="col-9"><label class="small">2. 是否有屬靈的親密同伴可以分享代禱？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="G" oninput="calcAll()"></div>

            <div class="col-9"><label class="small">3. 是否有天天彼此代禱的同伴？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="H" oninput="calcAll()"></div>
             <font color=blue>禁禱、禱告會</font>
            <div class="col-9"><label class="small">4. 有沒有在每周禁禱一餐？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="I" oninput="calcAll()"></div>

            <div class="col-9"><label class="small">5. 有沒有參加教會晨禱會或各樣禱告聚會？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="J" oninput="calcAll()"></div>
          </div>
          <div class="mt-2 text-end"><small>平均：<span id="avgB">-</span></small></div>
        </div>
                          
        <!-- 服事 A -->
        <div class="mb-3">
          <div class="section-title mb-2">三、服事(A)：角色管理</div>
          <div class="row g-2 align-items-center">
            <div class="col-9"><label class="small">1. 時間管理：工作、服事、休閒是否均衡？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="K" oninput="calcAll()"></div>
             <font color=blue>金錢管理</font>
            <div class="col-9"><label class="small">2. 金錢使用是否合宜？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="L" oninput="calcAll()"></div>

            <div class="col-9"><label class="small">3. 什一奉獻的情形是否穩定？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="M" oninput="calcAll()"></div>
            <font color=blue>角色扮演</font>
            <div class="col-9"><label class="small">4. 在工作上的服事角色是否勝任愉快？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="N" oninput="calcAll()"></div>

            <div class="col-9"><label class="small">5. 家庭裡的角色扮演是否稱職？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="O" oninput="calcAll()"></div>
          </div>
          <div class="mt-2 text-end"><small>平均：<span id="avgC">-</span></small></div>
        </div>

        <!-- 服事 B -->
        <div class="mb-3">
          <div class="section-title mb-2">四、服事(B)：服事人</div>
          <div class="row g-2 align-items-center">
            <font color=blue>參與小組、服事</font>
            <div class="col-9"><label class="small">1. 在小組中是否參與服事？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="P" oninput="calcAll()"></div>

            <div class="col-9"><label class="small">2. 週間與弟兄姊妹彼此關懷聯絡是否密切？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="Q" oninput="calcAll()"></div>

            <div class="col-9"><label class="small">3. 關懷(SPAM)：每週是否至少一次出去禱告 探訪有需要的人？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="R" oninput="calcAll()"></div>
           <font color=blue>傳福音、帶領人</font>
            <div class="col-9"><label class="small">4. 有沒有在帶領守望另一位小組員？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="S" oninput="calcAll()"></div>

            <div class="col-9"><label class="small">5. 是否定出每年帶多少人歸主的目標？</label></div>
            <div class="col-3"><input type="number" min="0" max="10" class="form-control score-box" id="T" oninput="calcAll()"></div>
          </div>
          <div class="mt-2 text-end"><small>平均：<span id="avgD">-</span></small></div>
        </div>

        <!-- 統計與下載 -->
        <div class="row mt-3 g-2">
          <div class="col-md-6">
            <div class="result-area">
              <div><strong>總分：</strong> <span id="totalScore">0</span> / 200</div>
              <div class="mt-1"><strong>平均：</strong> <span id="grandAvg">-</span> /10</div>
              <div class="mt-1"><strong>健康程度：</strong> <span id="healthLevel">-</span></div>
            </div>
          </div>

          <div class="col-md-6 text-end align-self-center">
            <button class="btn btn-primary btn-download me-2" id="btnPDF">生成 PDF</button>
            <button class="btn btn-outline-secondary" id="btnClear">清除</button>
          </div>
        </div>

        
      </div>
    </div>
  </div>

        <hr class="my-3">
<!-- 表單返回頁，記得在表單加「 target='returnWin' 」 -->
 <iframe name="returnWin" style="display: none;" onload="this.onload=function(){window.location='ok.html'}"></iframe>
        <!-- 可選：Google Forms 區域（保留原欄位） -->
        <form target="returnWin" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSeQgu5pbffTA8mSKpLDdkJcqCUkJ-rAA1RL_N2TO-_CUgQOpQ/formResponse" method="post" id="gForm">
          <!-- <iframe name="returnWin" style="display:none"></iframe> -->

          <div class="row g-2">
            <div class="col-md-6">
              <label class="form-label">姓名</label>
              <input type="text" class="form-control" name="entry.713165511" id="713165511" placeholder="請填姓名">
            </div>
            <div class="col-md-6">
              <label class="form-label">小組</label>
              <input type="text" class="form-control" name="entry.361915588" id="361915588" placeholder="請填小組">
            </div>
            <div class="col-md-6">
              <label class="form-label">總分</label>
              <input type="number" class="form-control" name="entry.1238984697" id="1238984697" min="0" max="200">
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label">檢查結果：不良項目（請簡單列出）</label>
            <input type="text" class="form-control" name="entry.184155140" id="184155140">
          </div>
          <div class="mt-2">
            <label class="form-label">不良的原因</label>
            <textarea class="form-control" rows="2" name="entry.580183999" id="580183999"></textarea>
          </div>
          <div class="mt-2">
            <label class="form-label">我想怎麼加強</label>
            <textarea class="form-control" rows="2" name="entry.481500218" id="481500218"></textarea>
          </div>
          <div class="mt-2">
            <label class="form-label">我需要的幫助</label>
            <textarea class="form-control" rows="2" name="entry.1067921084" id="1067921084"></textarea>
          </div>

          <div class="text-center mt-3">
            <button type="submit" class="btn btn-success">送出到 Google 表單（選用）</button>
          </div>
        </form>
  
        <blockquote class="mt-4 text-center">
          <h5 style="color:#e74c3c">不論你覺得自己多麼軟弱，總要記得：</h5>
          <h4 style="color:#2980b9">「耶穌愛我，我知道！」</h4>
           <img src="../assets/img/body.jpg" width="380px">
        </blockquote>
      </div> <!-- pdfArea end -->
    </div> <!-- card end -->
  </div> <!-- container end -->

  <!-- libs: html2canvas + jspdf (include jspdf with html2canvas plugin) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- scripts -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    function val(id){const v=Number(document.getElementById(id)?.value||0);return isNaN(v)?0:v;}

    function calcAll(){
      const groups=[['A','B','C','D','E'],['F','G','H','I','J'],['K','L','M','N','O'],['P','Q','R','S','T']];
      let total=0,count=0;
      groups.forEach((arr,i)=>{
        let sum=0;arr.forEach(id=>sum+=val(id));
        const avg=sum?Math.round(sum/arr.length*10)/10:'-';
        document.getElementById(['avgA','avgB','avgC','avgD'][i]).innerText=avg;
        total+=sum;count+=arr.length;
      });
      document.getElementById('totalScore').innerText=total;
      const grand=total?Math.round(total/count*10)/10:'-';
      document.getElementById('grandAvg').innerText=grand;
      document.getElementById('healthLevel').innerText=grand==='-'?'-':grand>=7?'良好':grand>=4?'普通':'需關注';
    }

    document.getElementById('btnClear').onclick=()=>{document.querySelectorAll('input[type=number]').forEach(i=>i.value='');calcAll();};
    window.onload=calcAll;

    document.getElementById('btnPDF').onclick=async()=>{
      const { jsPDF } = window.jspdf;
      const area=document.getElementById('pdfArea');
      const canvas=await html2canvas(area,{scale:2});
      const img=canvas.toDataURL('image/png');
      const pdf=new jsPDF('p','mm','a4');
      const w=pdf.internal.pageSize.getWidth()-20;
      const h=canvas.height*(w/canvas.width);
      pdf.addImage(img,'PNG',10,10,w,h);
      const today=new Date().toISOString().split('T')[0];
      pdf.save(`屬靈健康檢查_${today}.pdf`);
    };
  </script>
</body>
</html>